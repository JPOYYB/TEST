<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Bar Manager vs Demon System (Prototype)</title>
  <style>
    :root { --pad: 14px; }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", sans-serif; background:#0b0d12; color:#e9eef7; }
    .wrap { max-width: 820px; margin: 0 auto; padding: var(--pad); }
    .card { background:#121724; border:1px solid #26304a; border-radius:16px; padding: var(--pad); box-shadow: 0 8px 24px rgba(0,0,0,.35); }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .row > * { flex:1; min-width: 220px; }
    h1 { font-size: 18px; margin:0 0 8px; }
    h2 { font-size: 14px; margin: 16px 0 8px; opacity:.9; }
    .muted { opacity:.75; font-size: 12px; line-height:1.5; }
    .stats { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .pill { background:#0f1420; border:1px solid #23304d; border-radius:999px; padding:8px 10px; font-size:12px; display:flex; justify-content:space-between; }
    .bar { height:10px; background:#0a0f1b; border:1px solid #23304d; border-radius:999px; overflow:hidden; }
    .fill { height:100%; width:50%; background:#4aa3ff; }
    .btns { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    button { appearance:none; border:1px solid #2d3a5a; background:#16203a; color:#e9eef7; border-radius:12px; padding:12px 12px; font-weight:600; cursor:pointer; flex:1; min-width: 220px; }
    button:disabled { opacity:.5; cursor:not-allowed; }
    button:hover:not(:disabled) { filter: brightness(1.08); }
    .danger { border-color:#5a2d2d; background:#2a1212; }
    .good { border-color:#2d5a3a; background:#122a1b; }
    .modalBack { position:fixed; inset:0; background: rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; padding:16px; }
    .modal { width:min(720px, 100%); }
    .log { font-size:12px; line-height:1.55; background:#0f1420; border:1px solid #23304d; border-radius:12px; padding:10px; height:160px; overflow:auto; white-space:pre-wrap; }
    .mini { display:none; }
    .mini .panel { background:#0f1420; border:1px solid #23304d; border-radius:12px; padding:12px; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .big { font-size: 16px; font-weight:800; }
    .center { text-align:center; }
    input[type="range"] { width:100%; }
    .meter { font-variant-numeric: tabular-nums; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 12px; padding:2px 6px; border:1px solid #2d3a5a; border-radius:8px; background:#0f1420; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Bar Manager vs Demon Systemï¼ˆè¶…ç°¡æ˜“ãƒ—ãƒ­ãƒˆï¼‰</h1>
      <div class="muted">
        æ¯æ—¥1ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã ã‘ã€‚ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã®çµæœã§ã€Œææ€–ã€ã€Œå…µç«™ã€ã€Œå‘ªã„ã€ã‚’å‰Šã‚‹ã€‚<br/>
        å…¨éƒ¨0ã«ãªã£ãŸã‚‰å‹ã¡ã€‚æ—¥æ•°åˆ‡ã‚Œã§è² ã‘ã€‚å‹‡è€…å‘ãã˜ã‚ƒãªã„ã¯ãšãŒã€å¸³å°»ãŒåˆã£ã¦ã—ã¾ã†ä¸–ç•Œã€‚
      </div>

      <h2>çŠ¶æ…‹</h2>
      <div class="stats">
        <div class="pill"><span>Day</span><span class="meter" id="day">1</span></div>
        <div class="pill"><span>Gold</span><span class="meter" id="gold">50</span></div>
        <div class="pill"><span>Reputation</span><span class="meter" id="rep">0</span></div>
      </div>

      <h2>é­”ç‹ã®æ”¯é…ãƒ¡ãƒ¼ã‚¿ãƒ¼ï¼ˆã“ã‚Œã‚’å…¨éƒ¨0ã¸ï¼‰</h2>
      <div class="row">
        <div>
          <div class="pill"><span>ææ€–</span><span class="meter" id="mFearTxt">80</span></div>
          <div class="bar"><div class="fill" id="mFear"></div></div>
        </div>
        <div>
          <div class="pill"><span>å…µç«™</span><span class="meter" id="mSupplyTxt">80</span></div>
          <div class="bar"><div class="fill" id="mSupply"></div></div>
        </div>
        <div>
          <div class="pill"><span>å‘ªã„</span><span class="meter" id="mCurseTxt">80</span></div>
          <div class="bar"><div class="fill" id="mCurse"></div></div>
        </div>
      </div>

      <h2>ä»Šæ—¥ã®è¡Œå‹•ï¼ˆ1ã¤ã ã‘ï¼‰</h2>
      <div class="btns">
        <button id="btnCook">ğŸ¢ ä»•è¾¼ã¿ï¼ˆãƒŸãƒ‹ï¼šã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰â†’ å‘ªã„ã‚’å‰Šã‚‹</button>
        <button id="btnTalk">ğŸ—£ï¸ æ¥å®¢ï¼ˆãƒŸãƒ‹ï¼šé¸æŠï¼‰â†’ ææ€–ã‚’å‰Šã‚‹</button>
        <button id="btnTrade">ğŸ“¦ ä»•å…¥ã‚Œï¼ˆãƒŸãƒ‹ï¼šä¾¡æ ¼åˆã‚ã›ï¼‰â†’ å…µç«™ã‚’å‰Šã‚‹</button>
      </div>

      <div class="btns">
        <button class="danger" id="btnSkip">ä»Šæ—¥ã¯é–‰åº—ï¼ˆä½•ã‚‚ã—ãªã„ï¼‰</button>
        <button class="good" id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <h2>ãƒ­ã‚°</h2>
      <div class="log" id="log"></div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modalBack" id="modalBack">
    <div class="modal card">
      <div id="miniCook" class="mini">
        <h2>ä»•è¾¼ã¿ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ï¼šã‚¿ã‚¤ãƒŸãƒ³ã‚°</h2>
        <div class="muted">ãƒãƒ¼ãŒä¸­å¤®ã®â€œç·‘ã‚¾ãƒ¼ãƒ³â€ã«æ¥ãŸç¬é–“ã« <span class="kbd">STOP</span>ã€‚æˆåŠŸã§å‘ªã„ã‚’å¤§ããå‰Šã‚‹ã€‚</div>
        <div class="panel">
          <div class="bar" style="height:16px; position:relative;">
            <div id="cookFill" class="fill" style="width:0%;"></div>
            <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; gap:6px;">
              <div style="width:18%; height:8px; background:#2a6; border-radius:999px; opacity:.9;"></div>
            </div>
          </div>
          <div class="row" style="margin-top:10px;">
            <button id="cookStop">STOP</button>
            <button class="danger" id="closeCook">ã‚„ã‚ã‚‹</button>
          </div>
          <div class="muted" id="cookHint" style="margin-top:8px;"></div>
        </div>
      </div>

      <div id="miniTalk" class="mini">
        <h2>æ¥å®¢ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ï¼šä¸€è¨€ã§ç©ºæ°—ã‚’å¤‰ãˆã‚‹</h2>
        <div class="muted">â€œå®¢ã®ã‚¿ã‚¤ãƒ—â€ã«åˆã†è¿”ã—ã‚’é¸ã¶ã€‚æˆåŠŸã§ææ€–ã‚’å‰Šã‚‹ã€‚</div>
        <div class="panel">
          <div class="big" id="talkPrompt">â€”</div>
          <div class="grid2" style="margin-top:10px;">
            <button id="tA">A</button>
            <button id="tB">B</button>
            <button id="tC">C</button>
            <button class="danger" id="closeTalk">ã‚„ã‚ã‚‹</button>
          </div>
          <div class="muted" id="talkHint" style="margin-top:8px;"></div>
        </div>
      </div>

      <div id="miniTrade" class="mini">
        <h2>ä»•å…¥ã‚ŒãƒŸãƒ‹ã‚²ãƒ¼ãƒ ï¼šä¾¡æ ¼åˆã‚ã›</h2>
        <div class="muted">ç›¸æ‰‹ãŒé£²ã¿è¾¼ã‚ã‚‹â€œå¦¥å½“ãƒ©ã‚¤ãƒ³â€ã«è¿‘ã„ä¾¡æ ¼ã‚’å‡ºã™ã€‚è¿‘ã„ã»ã©å…µç«™ã‚’å‰Šã‚‹ã€‚</div>
        <div class="panel">
          <div class="big" id="tradePrompt">â€”</div>
          <div style="margin-top:10px;">
            <input id="price" type="range" min="0" max="100" value="50" />
            <div class="center muted">æç¤ºä¾¡æ ¼ï¼š<span class="meter" id="priceTxt">50</span></div>
          </div>
          <div class="row" style="margin-top:10px;">
            <button id="tradeDeal">DEAL</button>
            <button class="danger" id="closeTrade">ã‚„ã‚ã‚‹</button>
          </div>
          <div class="muted" id="tradeHint" style="margin-top:8px;"></div>
        </div>
      </div>

      <div class="mini" id="miniEnd">
        <h2 id="endTitle">â€”</h2>
        <div class="panel">
          <div id="endBody" class="muted"></div>
          <div class="btns" style="margin-top:10px;">
            <button class="good" id="endOk">OK</button>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
(() => {
  const MAX_DAYS = 14;

  const S = {
    day: 1,
    gold: 50,
    rep: 0,
    fear: 80,
    supply: 80,
    curse: 80,
    actedToday: false,
  };

  const el = (id) => document.getElementById(id);

  const ui = {
    day: el("day"),
    gold: el("gold"),
    rep: el("rep"),
    mFearTxt: el("mFearTxt"),
    mSupplyTxt: el("mSupplyTxt"),
    mCurseTxt: el("mCurseTxt"),
    mFear: el("mFear"),
    mSupply: el("mSupply"),
    mCurse: el("mCurse"),
    log: el("log"),
    modalBack: el("modalBack"),
    miniCook: el("miniCook"),
    miniTalk: el("miniTalk"),
    miniTrade: el("miniTrade"),
    miniEnd: el("miniEnd"),
    endTitle: el("endTitle"),
    endBody: el("endBody"),
  };

  const btnCook = el("btnCook");
  const btnTalk = el("btnTalk");
  const btnTrade = el("btnTrade");
  const btnSkip = el("btnSkip");
  const btnReset = el("btnReset");

  function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }

  function log(msg) {
    const t = new Date();
    const stamp = `${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`;
    ui.log.textContent = `[${stamp}] ${msg}\n` + ui.log.textContent;
  }

  function meterFill(v) {
    return `${clamp(v, 0, 100)}%`;
  }

  function update() {
    ui.day.textContent = S.day;
    ui.gold.textContent = S.gold;
    ui.rep.textContent = S.rep;

    ui.mFearTxt.textContent = S.fear;
    ui.mSupplyTxt.textContent = S.supply;
    ui.mCurseTxt.textContent = S.curse;

    ui.mFear.style.width = meterFill(S.fear);
    ui.mSupply.style.width = meterFill(S.supply);
    ui.mCurse.style.width = meterFill(S.curse);

    const disable = S.actedToday;
    btnCook.disabled = disable;
    btnTalk.disabled = disable;
    btnTrade.disabled = disable;
    btnSkip.disabled = disable;

    checkEnd();
  }

  function openModal(which) {
    ui.modalBack.style.display = "flex";
    [ui.miniCook, ui.miniTalk, ui.miniTrade, ui.miniEnd].forEach(x => x.style.display = "none");
    which.style.display = "block";
  }
  function closeModal() {
    ui.modalBack.style.display = "none";
  }

  function showEnd(title, body) {
    ui.endTitle.textContent = title;
    ui.endBody.innerHTML = body;
    openModal(ui.miniEnd);
  }

  function endDay() {
    S.actedToday = true;
    // æ—¥æ¬¡ã®å°å¤‰å‹•ï¼ˆä¸–ç•ŒãŒå‹æ‰‹ã«å‹•ãï¼‰
    // ç¹ç››ã—ã¦ã‚‹ã»ã©ææ€–ãŒä¸‹ãŒã‚‹ã€è²§ä¹ã ã¨å…µç«™ãŒå›å¾©ã—ã‚„ã™ã„â€¦ã¿ãŸã„ãªâ€œé›‘å‘³â€ã‚’æœ€å°ã ã‘
    const calmBonus = clamp(Math.floor(S.rep / 10), 0, 3);
    S.fear = clamp(S.fear - calmBonus, 0, 100);

    log(`Day ${S.day} çµ‚äº†ã€‚åº—ã®è©•åˆ¤ãŒè¡—ã®ç©ºæ°—ã‚’å°‘ã—æ•´ãˆãŸï¼ˆææ€– -${calmBonus}ï¼‰ã€‚`);
    update();
  }

  function nextDay() {
    S.day += 1;
    S.actedToday = false;
    log(`--- Day ${S.day} é–‹å§‹ ---`);
    update();
  }

  function checkEnd() {
    if (S.fear <= 0 && S.supply <= 0 && S.curse <= 0) {
      showEnd("å‹åˆ©ï¼šé­”ç‹ã€æˆç«‹ä¸èƒ½ã€‚", `
        ã‚ãªãŸã¯å‹‡è€…ã«å‘ã„ã¦ã„ãªã„ã¨æ€ã£ã¦ã„ãŸã€‚<br/>
        ã ãŒã€Œææ€–ã€ã€Œå…µç«™ã€ã€Œå‘ªã„ã€ã‚’ä¸€æœ¬ãšã¤æŠ˜ã£ãŸã®ã¯ã€åº—é•·ã¨ã—ã¦ã®æ—¥ã€…ã ã£ãŸã€‚<br/><br/>
        <b>çµæœï¼š</b>é­”ç‹ã®æ”¯é…ã¯ç ´ç¶»ã—ã€å‹æ‰‹ã«å´©ã‚ŒãŸã€‚<br/>
        ï¼ˆé­”ç‹ï¼šHPã˜ã‚ƒãªãã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼ã§æ­»ã¬ã‚¿ã‚¤ãƒ—ï¼‰
      `);
      disableAll();
    } else if (S.day > MAX_DAYS) {
      showEnd("æ•—åŒ—ï¼šæ—¥æ•°åˆ‡ã‚Œã€‚", `
        åº—ã¯å›ã£ãŸã€‚ã ãŒæ”¯é…ã®æŸ±ã¯æ®‹ã£ãŸã€‚<br/>
        æ¬¡ã¯ã€Œã©ã®ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãŒã©ã®è»¸ã‚’å‰Šã‚‹ã‹ã€ã‚’èª¿æ•´ã™ã‚‹ã¨ä¼¸ã³ã‚‹ã€‚
      `);
      disableAll();
    }
  }

  function disableAll() {
    btnCook.disabled = true;
    btnTalk.disabled = true;
    btnTrade.disabled = true;
    btnSkip.disabled = true;
  }

  // --- Mini: COOK (timing) ---
  const cookFill = el("cookFill");
  const cookStop = el("cookStop");
  const closeCook = el("closeCook");
  const cookHint = el("cookHint");
  let cookPos = 0;
  let cookDir = 1;
  let cookTimer = null;

  function startCook() {
    openModal(ui.miniCook);
    cookPos = 0;
    cookDir = 1;
    cookFill.style.width = "0%";
    cookHint.textContent = "ç·‘ã‚¾ãƒ¼ãƒ³ã¯ä¸­å¤®ä»˜è¿‘ï¼ˆç´„41%ã€œ59%ï¼‰ã€‚";
    if (cookTimer) clearInterval(cookTimer);
    cookTimer = setInterval(() => {
      cookPos += cookDir * (Math.random() * 3 + 2);
      if (cookPos >= 100) { cookPos = 100; cookDir = -1; }
      if (cookPos <= 0)   { cookPos = 0; cookDir =  1; }
      cookFill.style.width = cookPos + "%";
    }, 60);
  }

  function resolveCook() {
    if (cookTimer) clearInterval(cookTimer);
    cookTimer = null;
    const inGreen = (cookPos >= 41 && cookPos <= 59);
    const curseDown = inGreen ? 18 : 6;
    const goldUp = inGreen ? 14 : 6;
    const repUp = inGreen ? 2 : 0;

    S.curse = clamp(S.curse - curseDown, 0, 100);
    S.gold += goldUp;
    S.rep += repUp;

    log(`ä»•è¾¼ã¿ï¼š${inGreen ? "ç¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°" : "ã¾ã‚ã¾ã‚"}ï¼ˆå‘ªã„ -${curseDown} / Gold +${goldUp}${repUp?` / Rep +${repUp}`:""}ï¼‰`);
    closeModal();
    endDay();
  }

  // --- Mini: TALK (choice) ---
  const talkPrompt = el("talkPrompt");
  const talkHint = el("talkHint");
  const tA = el("tA"), tB = el("tB"), tC = el("tC"), closeTalk = el("closeTalk");

  function startTalk() {
    openModal(ui.miniTalk);

    const types = [
      { key:"panic",  prompt:"å®¢ï¼šã€æœ€è¿‘ã€å¤œãŒæ€–ã„ã€‚å¤–ã«å‡ºã‚‹ã®ã‚‚å«Œã ã€‚ã€", correct:"B",
        A:"ã€æ°—åˆã„ã§è¡Œã‘ã¾ã™ã€", B:"ã€ã¾ãšä»Šå¤œã ã‘ã€è½ã¡ç€ãæ®µå–ã‚Šã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€", C:"ã€ã¿ã‚“ãªåŒã˜ã ã‚ˆã€",
        hint:"æ­£è§£ã¯â€œæ„Ÿæƒ…â€ã‚ˆã‚Šâ€œæ®µå–ã‚Šâ€ã€‚"
      },
      { key:"rumor",  prompt:"å®¢ï¼šã€é­”ç‹è»ãŒæ¥ã‚‹ã£ã¦å™‚ã€èã„ãŸï¼Ÿã€", correct:"C",
        A:"ã€ãã‚Œæœ¬å½“ï¼Ÿï¼ˆæ‹¡æ•£ï¼‰ã€", B:"ã€é»™ã£ã¨ã“ã†ï¼ˆæ”¾ç½®ï¼‰ã€", C:"ã€å‡ºã©ã“ã‚ã¨æ ¹æ‹ ã‚’æŠ¼ã•ãˆã‚ˆã†ã€",
        hint:"æ­£è§£ã¯â€œå™‚â€ã‚’æƒ…å ±ã«è½ã¨ã™ã€‚"
      },
      { key:"anger",  prompt:"å®¢ï¼šã€ã‚ã„ã¤ã®ã›ã„ã§å…¨éƒ¨ãƒ€ãƒ¡ã ï¼ã€", correct:"A",
        A:"ã€ä¸€æ—¦ã“ã“ã§æ·±å‘¼å¸ã€‚ä»Šã§ãã‚‹ä¸€æ‰‹ã ã‘æ±ºã‚ã‚ˆã†ã€", B:"ã€ç›¸æ‰‹ã«ä»•è¿”ã—ã—ã‚ˆã†ã€", C:"ã€æ­£ã—ã„ã®ã¯å›ã ã€",
        hint:"æ­£è§£ã¯â€œç‡ƒæ–™â€ã‚’æ–­ã¤ã€‚"
      },
    ];
    const pick = types[Math.floor(Math.random() * types.length)];
    ui.miniTalk.dataset.correct = pick.correct;
    talkPrompt.textContent = pick.prompt;
    tA.textContent = pick.A;
    tB.textContent = pick.B;
    tC.textContent = pick.C;
    talkHint.textContent = pick.hint;
  }

  function resolveTalk(choice) {
    const ok = (choice === ui.miniTalk.dataset.correct);
    const fearDown = ok ? 18 : 6;
    const repUp = ok ? 3 : 0;
    const goldUp = ok ? 6 : 3;

    S.fear = clamp(S.fear - fearDown, 0, 100);
    S.rep += repUp;
    S.gold += goldUp;

    log(`æ¥å®¢ï¼š${ok ? "ç©ºæ°—ã‚’æ•‘ã£ãŸ" : "ç©ºæŒ¯ã‚Š"}ï¼ˆææ€– -${fearDown} / Gold +${goldUp}${repUp?` / Rep +${repUp}`:""}ï¼‰`);
    closeModal();
    endDay();
  }

  // --- Mini: TRADE (price match) ---
  const tradePrompt = el("tradePrompt");
  const tradeHint = el("tradeHint");
  const price = el("price");
  const priceTxt = el("priceTxt");
  const tradeDeal = el("tradeDeal");
  const closeTrade = el("closeTrade");
  let target = 50;

  function startTrade() {
    openModal(ui.miniTrade);
    target = Math.floor(Math.random() * 101);
    price.value = 50;
    priceTxt.textContent = "50";
    tradePrompt.textContent = "ä»•å…¥ã‚Œå±‹ï¼šã€ä»Šæ—¥ã¯ã“ã®è¾ºãŒè½ã¨ã—ã©ã“ã‚ã ãªã€";
    tradeHint.textContent = "å¦¥å½“ãƒ©ã‚¤ãƒ³ã«è¿‘ã„ã»ã©ã€é—‡ã®å…µç«™ã«é¢¨ç©´ãŒé–‹ãï¼ˆèª¤å·®ãŒå¤§ãã„ã¨å‰Šã‚ŠãŒå°ã•ã„ï¼‰ã€‚";
  }

  price.addEventListener("input", () => {
    priceTxt.textContent = String(price.value);
  });

  function resolveTrade() {
    const guess = Number(price.value);
    const diff = Math.abs(guess - target);
    // è¿‘ã„ã»ã©å¤§ãã„ï¼ˆ0å·®ã§18ã€50å·®ã§3ãã‚‰ã„ï¼‰
    const supplyDown = clamp(Math.round(18 - diff * 0.3), 3, 18);
    const cost = clamp(Math.round(guess / 10), 0, 12); // é«˜ã„ææ¡ˆã»ã©Goldã‚³ã‚¹ãƒˆå¢—
    const repUp = diff <= 8 ? 2 : 0;

    S.supply = clamp(S.supply - supplyDown, 0, 100);
    S.gold = clamp(S.gold - cost, 0, 999);
    S.rep += repUp;

    log(`ä»•å…¥ã‚Œï¼šæç¤º${guess}ï¼ˆèª¤å·®${diff}ï¼‰â†’ å…µç«™ -${supplyDown} / Gold -${cost}${repUp?` / Rep +${repUp}`:""}`);
    closeModal();
    endDay();
  }

  // --- Actions ---
  btnCook.addEventListener("click", () => { if (!S.actedToday) startCook(); });
  btnTalk.addEventListener("click", () => { if (!S.actedToday) startTalk(); });
  btnTrade.addEventListener("click", () => { if (!S.actedToday) startTrade(); });

  btnSkip.addEventListener("click", () => {
    if (S.actedToday) return;
    // ä¼‘ã‚€ã¨å°‘ã—å›å¾©ã•ã‚Œã‚‹ï¼é­”ç‹ãŒæ¯ã‚’ã™ã‚‹
    S.fear = clamp(S.fear + 4, 0, 100);
    S.supply = clamp(S.supply + 4, 0, 100);
    S.curse = clamp(S.curse + 4, 0, 100);
    log("ä»Šæ—¥ã¯é–‰åº—ã€‚ä¸–ç•Œã¯å‹æ‰‹ã«æ‚ªåŒ–ã—ãŸï¼ˆå„ +4ï¼‰ã€‚");
    endDay();
  });

  btnReset.addEventListener("click", () => {
    Object.assign(S, { day:1, gold:50, rep:0, fear:80, supply:80, curse:80, actedToday:false });
    ui.log.textContent = "";
    log("--- ãƒªã‚»ãƒƒãƒˆ ---");
    update();
  });

  // --- Mini hooks ---
  cookStop.addEventListener("click", resolveCook);
  closeCook.addEventListener("click", () => { if (cookTimer) clearInterval(cookTimer); cookTimer=null; closeModal(); });

  tA.addEventListener("click", () => resolveTalk("A"));
  tB.addEventListener("click", () => resolveTalk("B"));
  tC.addEventListener("click", () => resolveTalk("C"));
  closeTalk.addEventListener("click", () => closeModal());

  tradeDeal.addEventListener("click", resolveTrade);
  closeTrade.addEventListener("click", () => closeModal());

  el("endOk").addEventListener("click", () => { closeModal(); });

  // --- Day progression: tap background after action to proceed ---
  // è‡ªå‹•ã§ç¿Œæ—¥ã«è¡Œãã¨ãƒ†ãƒ³ãƒãŒè½ã¡ã‚‹ã®ã§ã€ãƒ­ã‚°ã§æ°—æŒã¡ã‚ˆãåŒºåˆ‡ã‚Šâ†’ã‚¿ãƒƒãƒ—ã§ç¿Œæ—¥
  ui.log.addEventListener("click", () => {
    if (!S.actedToday) return;
    if (S.day >= MAX_DAYS) return;
    if (S.fear <= 0 && S.supply <= 0 && S.curse <= 0) return;
    nextDay();
  });

  // init
  log("--- Day 1 é–‹å§‹ ---");
  log("ãƒ­ã‚°æ¬„ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€è¡Œå‹•å¾Œã«ç¿Œæ—¥ã¸é€²ã¿ã¾ã™ã€‚");
  update();
})();
</script>
</body>
</html>
